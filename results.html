<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Search for Kids - R√©sultats</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <script src="config.js"></script>
    <script>
        // Construction dynamique de l'URL du CSE
        const cseScript = document.createElement('script');
        cseScript.src = `https://cse.google.com/cse.js?cx=${CONFIG.GOOGLE_CSE_ID}`;
        cseScript.async = true;
        document.head.appendChild(cseScript);
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #fff;
        }

        .gsc-tabHeader {
            font-size: 14px;
        }

        /* Barre de recherche en haut */
        .search-container {
            position: relative;
            margin-left: 180px;
            margin-right: 40px;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .search-bar {
            display: flex;
            align-items: center;
        }

        .search-bar img {
            height: 40px;
            margin-right: 1rem;
        }

        .search-bar form {
            flex: 1;
            display: flex;
            position: relative;
        }

        .search-bar input[type="text"] {
            flex: 1;
            max-width: 600px;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            border: 1px solid #dcdcdc;
            border-radius: 24px 0 0 24px;
            outline: none;
        }

        .search-bar input[type="text"]:focus {
            border-color: #1a73e8;
            box-shadow: 0 0 0 1px #1a73e8;
        }

        .search-bar button {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 0 1rem;
            border-radius: 0 24px 24px 0;
            cursor: pointer;
            font-size: 1rem;
        }

        .search-bar button:hover {
            background-color: #1669c1;
        }

        /* Autocompl√©tion */
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 60px; /* Largeur du bouton */
            background: white;
            border: 1px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 24px 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 1rem;
            color: #333;
            border-bottom: 1px solid #f0f0f0;
        }

        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background-color: #f8f9fa;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        /* Conteneur principal des r√©sultats - style Google */
        .gsc-control-wrapper-cse {
            margin-left: 180px !important; /* M√™me marge que Google */
            margin-right: 40px !important;
            max-width: none !important;
        }

        .gcse-searchresults-only {
            font-size: 1.1rem;
            line-height: 1.6;
            margin: 2rem 0;
        }

        /* Titres des r√©sultats */
        .gs-title, .gs-title * {
            font-size: 1.2rem !important;
            color: #1a0dab !important;
        }

        /* URL et domaine */
        .gs-bidi-start-align, .gs-snippet, .gs-visibleUrl {
            font-size: 14px !important;
            line-height: 1.6;
            color: #545454 !important;
        }

        /* Snippet / description */
        .gs-snippet {
            margin-top: 4px;
        }

        /* Masquer tous les liens "Search more on Google" */
        .gcsc-find-more-on-google,
        .gcsc-find-more-on-google-text,
        .gcsc-find-more-on-google-query,
        .gcsc-find-more-on-google-magnifier {
            display: none !important;
        }
    </style>
</head>
<body>
<body>
<div class="search-container">
    <div class="search-bar">
        <a href="index.html"><img src="logo.png" alt="Logo"></a>
        <form onsubmit="doSearch(event)">
            <input type="text" id="searchInput" placeholder="Tape ta recherche..." required autocomplete="off">
            <button type="submit">üîç</button>
            <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
        </form>
    </div>
</div>

<div class="gcse-searchresults-only"></div>

<script>
    let suggestions = [];

    // Charger les suggestions depuis le fichier JSON
    fetch('suggestions.json')
        .then(response => response.json())
        .then(data => {
            suggestions = data.suggestions;
        })
        .catch(error => {
            console.error('Erreur lors du chargement des suggestions:', error);
            // Suggestions de fallback en cas d'erreur
            suggestions = ["animaux", "plan√®tes", "dinosaures", "sciences", "histoire"];
        });

    const params = new URLSearchParams(window.location.search);
    const query = params.get('q');
    const searchInput = document.getElementById('searchInput');
    const dropdown = document.getElementById('autocompleteDropdown');
    let selectedIndex = -1;

    if(query) {
        searchInput.value = query;
        // Mettre √† jour le titre de la page avec le terme recherch√©
        document.title = `${query} - Search for Kids`;
    }

    // Fonction pour mettre √† jour le titre lors des nouvelles recherches
    function updatePageTitle(searchQuery) {
        document.title = `${searchQuery} - Search for Kids`;
    }

    // Autocompl√©tion
    searchInput.addEventListener('input', function() {
        const value = this.value.toLowerCase().trim();

        if (value.length < 2) {
            hideDropdown();
            return;
        }

        const filtered = suggestions.filter(item =>
            item.toLowerCase().includes(value)
        ).slice(0, 8); // Limite √† 8 suggestions

        if (filtered.length > 0) {
            showSuggestions(filtered);
        } else {
            hideDropdown();
        }
    });

    searchInput.addEventListener('keydown', function(e) {
        const items = dropdown.querySelectorAll('.autocomplete-item');

        if (e.key === 'ArrowDown') {
            e.preventDefault();
            selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
            updateSelection(items);
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            selectedIndex = Math.max(selectedIndex - 1, -1);
            updateSelection(items);
        } else if (e.key === 'Enter') {
            if (selectedIndex >= 0 && items[selectedIndex]) {
                e.preventDefault();
                selectSuggestion(items[selectedIndex].textContent);
            }
        } else if (e.key === 'Escape') {
            hideDropdown();
        }
    });

    // Cacher le dropdown si on clique ailleurs
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
            hideDropdown();
        }
    });

    function showSuggestions(filtered) {
        dropdown.innerHTML = '';
        selectedIndex = -1;

        filtered.forEach(item => {
            const div = document.createElement('div');
            div.className = 'autocomplete-item';
            div.textContent = item;
            div.addEventListener('click', () => selectSuggestion(item));
            dropdown.appendChild(div);
        });

        dropdown.style.display = 'block';
    }

    function hideDropdown() {
        dropdown.style.display = 'none';
        selectedIndex = -1;
    }

    function updateSelection(items) {
        items.forEach((item, index) => {
            item.classList.toggle('selected', index === selectedIndex);
        });
    }

    function selectSuggestion(suggestion) {
        searchInput.value = suggestion;
        hideDropdown();
        // Lancer automatiquement la recherche
        const element = google.search.cse.element.getElement('searchresults-only0');
        if(element) element.execute(suggestion);
        // Mettre √† jour le titre de la page
        updatePageTitle(suggestion);
        // Mettre √† jour l'URL sans recharger la page
        const newUrl = new URL(window.location);
        newUrl.searchParams.set('q', suggestion);
        window.history.pushState({}, '', newUrl);
    }

    window.onload = () => {
        const element = google.search.cse.element.getElement('searchresults-only0');
        if(element && query) element.execute(query);

        const selectors = [
            '.gcsc-find-more-on-google',
            '.gcsc-find-more-on-google-text',
            '.gcsc-find-more-on-google-query',
            '.gcsc-find-more-on-google-magnifier'
        ];
        setTimeout(() => {
            selectors.forEach(sel => {
                const el = document.querySelector(sel);
                if(el) el.style.display = 'none';
            });
        }, 1000);
    };

    function doSearch(event) {
        event.preventDefault();
        const newQuery = searchInput.value;
        const element = google.search.cse.element.getElement('searchresults-only0');
        if(element) element.execute(newQuery);
        hideDropdown();
        // Mettre √† jour le titre de la page
        updatePageTitle(newQuery);
        // Mettre √† jour l'URL sans recharger la page
        const newUrl = new URL(window.location);
        newUrl.searchParams.set('q', newQuery);
        window.history.pushState({}, '', newUrl);
    }
</script>
</body>
</html>